@{
    ViewData["Title"] = "Ana Sayfa";
}

<section class="hero-section">
    <div class="container">
        <h1 class="display-4">Yeni Dostunu Burada Bul!</h1>
        <p class="lead">Evcil hayvan sahiplen, güvenilir satıcılarla buluş, en uygun yemleri keşfet.</p>
        <div class="row mt-5">
            <div class="col-md-8 offset-md-2">
                <h4>Ne arıyorsunuz?</h4>
                <div class="row">
                    <div class="col-3 pet-category">
                        <a href="/Kategori/Kategoriler" style="text-decoration:none; color:inherit;">
                            <img src="https://cdn.pixabay.com/photo/2016/12/13/05/15/puppy-1903313_640.jpg" alt="Köpek" />
                            <h5>Köpekler</h5>
                        </a>
                    </div>
                    <div class="col-3 pet-category">
                        <a href="/Kategori/Kategoriler" style="text-decoration:none; color:inherit;">
                            <img src="https://cdn.pixabay.com/photo/2017/02/20/18/03/cat-2083492_640.jpg" alt="Kedi" />
                            <h5>Kediler</h5>
                        </a>
                    </div>
                    <div class="col-3 pet-category">
                        <a href="/Kategori/Kategoriler" style="text-decoration:none; color:inherit;">
                            <img src="https://cdn.pixabay.com/photo/2016/12/31/21/22/aquarium-1943755_640.jpg" alt="Akvaryum" />
                            <h5>Akvaryum</h5>
                        </a>
                    </div>
                    <div class="col-3 pet-category">
                        <a href="/Kategori/Kategoriler" style="text-decoration:none; color:inherit;">
                            <img src="https://cdn.pixabay.com/photo/2018/08/12/16/59/parrot-3601194_640.jpg" alt="Kuş" />
                            <h5>Kuşlar</h5>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="container-fluid">
        <div class="row popular-pets">
            <div class="col-12">
                <h2 class="text-center mb-4">Popüler</h2>
            </div>
            <div id="petList" class="row">
                <!-- Evcil hayvanlar AJAX ile buraya yüklenecek -->
            </div>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            $.ajax({
                url: '/Anasayfa/GetCats',
                type: 'GET',
                beforeSend: function () {
                    $('#petList').html('<p>Yükleniyor...</p>');
                },
                success: function (data) {
                    let petList = $('#petList');
                    petList.empty();
                    $.each(data, function (Anasayfa, pet) {
                        let priceHtml = pet.price > 0 ? `<h4 class="text-primary">${pet.price} TL</h4>` : `<p class="text-success">Sahiplendirme</p>`;
                        let descriptionHtml = pet.description ? `<p class="text-muted">${pet.description}</p>` : '';
                        let petHtml = `
                            <div class="col-md-3">
                                <a href="/Animal/Details/${pet.id}" style="text-decoration:none; color:inherit;">
                                    <div class="pet-card">
                                        <img src="${pet.imageUrl}" alt="${pet.name}" />
                                        <div class="pet-card-body">
                                            <h5>${pet.name}</h5>
                                            ${descriptionHtml}
                                            ${priceHtml}
                                            <div class="mt-2">
                                                <button class="btn btn-success btn-sm me-2" onclick="addToCart(${pet.id})">Sepete Ekle</button>
                                                <a href="/Animal/Details/${pet.id}" class="btn btn-secondary btn-sm">Detay</a>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>`;
                        petList.append(petHtml);
                    });
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata!',
                        text: 'Evcil hayvanlar yüklenemedi.'
                    });
                }
            });
        });

        function addToCart(id) {
            $.ajax({
                url: '/Cart/AddToSepet',
                type: 'POST',
                data: { id: id },
                success: function (response) {
                    if (response.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Başarılı!',
                            text: response.message,
                            timer: 1500,
                            showConfirmButton: false
                        }).then(() => {
                            window.location.href = '/Cart';
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Hata!',
                            text: response.message
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata!',
                        text: 'Sepete ekleme başarısız.'
                    });
                }
            });
        }
    </script>
}